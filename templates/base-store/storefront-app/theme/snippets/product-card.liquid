{% comment %}
  Product Card Snippet
  Usage: {% render 'product-card', product: product %}
{% endcomment %}

{% assign color_index = product.id | slice: -1 | plus: 0 | modulo: 5 %}
{% assign gradients = '#e8a598,#d4776a|#c9b896,#a89774|#98c4b8,#6fa396|#b8a4c9,#957aab|#dbc398,#c4a66a' | split: '|' %}
{% assign gradient_colors = gradients[color_index] | split: ',' %}

<a href="/products/{{ product.slug | default: product.id }}" style="display: block;">
  <div class="card" style="transform: translateY(0); transition: all 0.3s;" data-price="{{ product.priceCents }}" data-date="{{ product.createdAt }}">
    <!-- Image -->
    <div style="aspect-ratio: 1; position: relative; overflow: hidden; background: #f5f1eb;">
      {% if product.imageUrl %}
        <img
          src="{{ product.imageUrl }}"
          alt="{{ product.title }}"
          style="width: 100%; height: 100%; object-fit: cover; transform: scale(1); transition: transform 0.5s;"
          onmouseover="this.style.transform='scale(1.05)'"
          onmouseout="this.style.transform='scale(1)'"
        />
      {% else %}
        <div style="width: 100%; height: 100%; background: linear-gradient(135deg, {{ gradient_colors[0] }}, {{ gradient_colors[1] }}); display: flex; align-items: center; justify-content: center;">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="rgba(255,255,255,0.4)" stroke-width="2">
            <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <path d="M16 10a4 4 0 0 1-8 0"></path>
          </svg>
        </div>
      {% endif %}
      
      <!-- Quick Add Button -->
      <button
        onclick="event.preventDefault(); event.stopPropagation(); addToCartQuick('{{ product.id }}', this);"
        class="quick-add-btn"
        style="position: absolute; bottom: 1rem; right: 1rem; width: 2.5rem; height: 2.5rem; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: none; cursor: pointer; transition: all 0.3s; background: white; color: #2d2924; opacity: 0; box-shadow: 0 2px 8px rgba(0,0,0,0.12);"
        onmouseover="this.style.opacity='1'"
        onmouseout="this.style.opacity='0'"
      >
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
      </button>

      <!-- Stock Badge -->
      {% if product.stock != blank and product.stock <= 5 and product.stock > 0 %}
        <div class="badge badge-warning" style="position: absolute; top: 1rem; left: 1rem;">
          Only {{ product.stock }} left
        </div>
      {% endif %}
      {% if product.stock == 0 %}
        <div class="badge badge-error" style="position: absolute; top: 1rem; left: 1rem;">
          Out of stock
        </div>
      {% endif %}
    </div>

    <!-- Info -->
    <div style="padding: 1.25rem;">
      <h3 style="font-weight: 500; font-size: 1rem; color: #2d2924; transition: color 0.2s; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; font-family: 'Source Sans 3', sans-serif;">
        {{ product.title }}
      </h3>
      {% if product.description %}
        <p style="margin-top: 0.375rem; font-size: 0.875rem; color: #6b635a; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; line-height: 1.5;">
          {{ product.description }}
        </p>
      {% endif %}
      <p style="margin-top: 0.75rem; font-size: 1.125rem; font-weight: 600; color: #d95f3d;" data-price="{{ product.priceCents }}">
        {% assign price_dollars = product.priceCents | divided_by: 100.0 %}
        {% if store.currency == 'usd' or store.currency == blank %}
          ${{ price_dollars | round: 2 }}
        {% else %}
          {{ price_dollars | round: 2 }} {{ store.currency | upcase }}
        {% endif %}
      </p>
    </div>
  </div>
</a>
