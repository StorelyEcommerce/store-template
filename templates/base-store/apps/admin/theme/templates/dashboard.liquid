{% assign page_title = 'Dashboard' %}

{% render 'page-header', title: 'Dashboard', description: 'Overview for ' | append: selected_store.slug %}

<!-- Stats Grid -->
<div style="display: grid; grid-template-columns: repeat(1, 1fr); gap: 1rem; margin-bottom: 2rem;">
  {% assign total_revenue = 0 %}
  {% for payment in payments %}
    {% if payment.status == 'succeeded' %}
      {% assign total_revenue = total_revenue | plus: payment.amountCents %}
    {% endif %}
  {% endfor %}
  
  {% assign succeeded_payments_count = 0 %}
  {% for payment in payments %}
    {% if payment.status == 'succeeded' %}
      {% assign succeeded_payments_count = succeeded_payments_count | plus: 1 %}
    {% endif %}
  {% endfor %}
  
  {% render 'stat-card', title: 'Total Revenue', value: total_revenue | divided_by: 100.0 | money: 'usd', icon: 'dollar', color: 'green' %}
  {% render 'stat-card', title: 'Products', value: products.size, icon: 'package', color: 'primary' %}
  {% render 'stat-card', title: 'Orders', value: orders.size, icon: 'cart', color: 'amber' %}
  {% render 'stat-card', title: 'Payments', value: succeeded_payments_count, icon: 'credit-card', color: 'green' %}
</div>

<div style="display: grid; grid-template-columns: repeat(1, 1fr); gap: 1.5rem;">
  <!-- Recent Orders -->
  <div class="card">
    <div style="padding: 1.25rem 1.25rem; border-bottom: 1px solid #1e293b; display: flex; align-items: center; justify-content: space-between;">
      <h2 style="font-weight: 600; color: #f1f5f9;">Recent Orders</h2>
      <a href="/orders" style="font-size: 0.875rem; color: #818cf8; display: flex; align-items: center; gap: 0.25rem;">
        View all
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="7" y1="17" x2="17" y2="7"></line>
          <polyline points="7 7 17 7 17 17"></polyline>
        </svg>
      </a>
    </div>
    
    {% assign recent_orders = orders | limit: 5 %}
    {% if recent_orders.size == 0 %}
      <div style="padding: 2rem; text-align: center; color: #64748b;">
        No orders yet
      </div>
    {% else %}
      <div style="border-top: 1px solid #1e293b;">
        {% for order in recent_orders %}
          <div style="padding: 0.75rem 1.25rem; display: flex; align-items: center; justify-content: space-between; {% unless forloop.last %}border-bottom: 1px solid rgba(30, 41, 59, 0.5);{% endunless %}">
            <div>
              <p style="font-size: 0.875rem; color: #f1f5f9; font-weight: 500;">{{ order.userEmail }}</p>
              <p style="font-size: 0.75rem; color: #64748b;">{{ order.createdAt | date: '%b %d, %Y %I:%M %p' }}</p>
            </div>
            <div style="text-align: right;">
              <p style="font-size: 0.875rem; font-family: 'JetBrains Mono', monospace; color: #f1f5f9;">{{ order.totalCents | divided_by: 100.0 | money: order.currency }}</p>
              <span class="badge {% if order.status == 'paid' %}badge-success{% elsif order.status == 'pending' %}badge-warning{% else %}badge-error{% endif %}" style="margin-top: 0.25rem; display: inline-block;">
                {{ order.status }}
              </span>
            </div>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  </div>

  <!-- Store Performance -->
  <div class="card">
    <div style="padding: 1.25rem 1.25rem; border-bottom: 1px solid #1e293b;">
      <h2 style="font-weight: 600; color: #f1f5f9;">Store Performance</h2>
    </div>
    
    <div style="padding: 1.25rem; display: flex; flex-direction: column; gap: 1rem;">
      <div style="display: flex; align-items: center; justify-content: space-between; padding: 1rem; background: rgba(30, 41, 59, 0.5); border-radius: 0.5rem;">
        <div style="display: flex; align-items: center; gap: 0.75rem;">
          <div style="padding: 0.5rem; background: rgba(16, 185, 129, 0.1); border-radius: 0.5rem;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#34d399" stroke-width="2">
              <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
              <polyline points="17 6 23 6 23 12"></polyline>
            </svg>
          </div>
          <div>
            <p style="font-size: 0.875rem; color: #94a3b8;">Active Products</p>
            <p style="font-size: 1.125rem; font-weight: 600; color: #f1f5f9;">
              {% assign active_products = products | where: 'isActive', true | size %}
              {{ active_products }}
            </p>
          </div>
        </div>
        <span style="font-size: 0.75rem; color: #64748b;">
          of {{ products.size }} total
        </span>
      </div>

      <div style="display: flex; align-items: center; justify-content: space-between; padding: 1rem; background: rgba(30, 41, 59, 0.5); border-radius: 0.5rem;">
        <div style="display: flex; align-items: center; gap: 0.75rem;">
          <div style="padding: 0.5rem; background: rgba(245, 158, 11, 0.1); border-radius: 0.5rem;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#fbbf24" stroke-width="2">
              <circle cx="9" cy="21" r="1"></circle>
              <circle cx="20" cy="21" r="1"></circle>
              <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
            </svg>
          </div>
          <div>
            <p style="font-size: 0.875rem; color: #94a3b8;">Pending Orders</p>
            <p style="font-size: 1.125rem; font-weight: 600; color: #f1f5f9;">
              {% assign pending_orders = orders | where: 'status', 'pending' | size %}
              {{ pending_orders }}
            </p>
          </div>
        </div>
        <a href="/orders" style="font-size: 0.75rem; color: #818cf8;">
          View
        </a>
      </div>

      <div style="display: flex; align-items: center; justify-content: space-between; padding: 1rem; background: rgba(30, 41, 59, 0.5); border-radius: 0.5rem;">
        <div style="display: flex; align-items: center; gap: 0.75rem;">
          <div style="padding: 0.5rem; background: rgba(99, 102, 241, 0.1); border-radius: 0.5rem;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#818cf8" stroke-width="2">
              <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
              <line x1="1" y1="10" x2="23" y2="10"></line>
            </svg>
          </div>
          <div>
            <p style="font-size: 0.875rem; color: #94a3b8;">Successful Payments</p>
            <p style="font-size: 1.125rem; font-weight: 600; color: #f1f5f9;">
              {% assign successful_payments = payments | where: 'status', 'succeeded' | size %}
              {{ successful_payments }}
            </p>
          </div>
        </div>
        <a href="/payments" style="font-size: 0.75rem; color: #818cf8;">
          View
        </a>
      </div>
    </div>
  </div>
</div>
